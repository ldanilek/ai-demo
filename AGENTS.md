## Cloud-specific instructions

### Required secrets

- `CONVEX_DEPLOY_KEY` — Convex Preview Deploy Key. Generate from the Convex dashboard: Project → Settings → Deploy Keys → Preview Deploy Key.

### Overview

AI Demo Arena is a React + Convex app that compares HTML/CSS/JS outputs from multiple AI models side-by-side. The frontend runs locally via Vite; the backend (database, real-time subscriptions, serverless actions) is hosted on Convex cloud.

### Services

| Service | Command | Notes |
|---|---|---|
| Vite dev server | `npx vite --host 0.0.0.0` | Serves at http://localhost:5173 |
| Convex backend | `npx convex dev --preview-name <name>` | Watches and pushes changes to a preview deployment. Requires `CONVEX_DEPLOY_KEY`. |

### Preview Deployment (backend development)

The update script automatically creates a Convex preview deployment on startup when `CONVEX_DEPLOY_KEY` is set. It:

1. Derives a preview name from the current git branch
2. Runs `npx convex dev --preview-name <name> --once` to push Convex functions
3. Runs `node scripts/setup-preview-auth.mjs` to configure JWT keys for `@convex-dev/auth` anonymous authentication (idempotent — skips if already configured)

After modifying any files in `convex/`, re-deploy with:

```
PREVIEW_NAME=$(git branch --show-current | tr '/' '-')
npx convex dev --preview-name "${PREVIEW_NAME:-cloud-agent}" --once
```

Or for continuous hot-reloading during development:

```
PREVIEW_NAME=$(git branch --show-current | tr '/' '-')
npx convex dev --preview-name "${PREVIEW_NAME:-cloud-agent}"
```

### Running the frontend

```
npx vite --host 0.0.0.0
```

Vite reads `VITE_CONVEX_URL` from `.env.local` (auto-generated by the Convex preview deploy step).

### Lint / Build

- **Lint**: `npm run lint` (ESLint)
- **Build**: `npm run build` (Vite)
- **Dev**: `npm run dev` (runs Vite + `convex dev` concurrently — but in cloud agent environments, run them separately so you can pass `--preview-name`)

### Caveats

- This project uses a custom `convex` build (`convex-1.32.0.tgz` from `ldanilek/convex-backend` releases) that adds `--preview-name` support to `convex dev`. The standard npm `convex` package does not have this flag.
- `@convex-dev/auth` anonymous auth requires `JWT_PRIVATE_KEY` and `JWKS` environment variables on the Convex deployment. The `scripts/setup-preview-auth.mjs` script generates and sets these automatically. Without them, "Continue as Guest" will fail.
- AI model generation requires API keys (`OPENAI_API_KEY`, `ANTHROPIC_API_KEY`, etc.) set on the Convex deployment. These are set at the project level and inherited by preview deployments. Individual model tiles will show "Error" if their provider's key is missing.
- The `claude-3-5-haiku-latest` model may error with "model not found" depending on Anthropic API availability.
